<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finans Okuryazarlığı Testi - Yeni</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ==== BAŞLANGIÇ: GENEL STILLER (main.css'ten geldiği varsayılan) ==== */
    :root {
      /* Açık Mod Renkleri */
      --primary-dark: #0A2342; --primary-medium: #003366; --accent-color: #2CA58D;
      --background-light: #F5F5F5; --background-white: #FFFFFF; --text-dark: #333333;
      --text-light: #FFFFFF; --border-color: #DDDDDD; --shadow-color: rgba(0, 0, 0, 0.1);
      --transition-speed: 0.3s;
      /* Karanlık Mod Renkleri */
      --dm-background-body: #121212; --dm-background-container: #1E2A38;
      --dm-text-primary: #E0E0E0; --dm-text-secondary: #B0B0B0;
      --dm-border-color: #333333; --dm-accent-color: var(--accent-color);
      --dm-shadow-color: rgba(0,0,0, 0.4);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Open Sans', Arial, sans-serif; margin: 0;
      background-color: var(--background-light); color: var(--text-dark);
      line-height: 1.6; font-size: 16px; padding-bottom: 100px; /* Footer için artırıldı */
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }
    header {
      background-color: var(--primary-dark); color: var(--text-light); padding: 20px 0;
      text-align: center; position: relative;
    }
    header h1 { margin: 0; font-size: 2.2em; font-weight: 600; }
    nav {
      background-color: var(--primary-medium); padding: 10px 0; text-align: center;
    }
    nav a {
      color: var(--text-light); text-decoration: none; margin: 0 15px; padding: 10px 20px;
      border-radius: 5px; transition: background-color var(--transition-speed), color var(--transition-speed);
      font-weight: 500;
    }
    nav a:hover, nav a.active { background-color: var(--accent-color); color: var(--text-light); }
    .container {
      width: 90%; max-width: 800px; margin: 30px auto; padding: 30px;
      background-color: var(--background-white); border-radius: 8px;
      box-shadow: 0 4px 15px var(--shadow-color);
      transition: background-color var(--transition-speed), box-shadow var(--transition-speed);
    }
    button, .button-style {
      background-color: var(--accent-color); color: var(--text-light); border: none;
      padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 1em;
      font-weight: 500; text-decoration: none; display: inline-block;
      transition: background-color var(--transition-speed), color var(--transition-speed), transform var(--transition-speed);
    }
    button:hover, .button-style:hover {
      background-color: var(--primary-medium); color: var(--text-light); transform: translateY(-2px);
    }
    footer {
      position: fixed; bottom: 0; left: 0; right: 0;
      background-color: var(--primary-dark); color: var(--text-light);
      text-align: center; padding: 15px;
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }
    /* ==== SON: GENEL STILLER ==== */

    /* ==== BAŞLANGIÇ: TEST SAYFASI YENİ STİLLERİ ==== */
    #quiz-container { /* Soruların ve kontrol butonlarının olacağı ana alan */
        min-height: 300px; /* İçerik değiştikçe zıplamayı önlemek için */
        position: relative;
    }
    .question-display {
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 8px;
      background-color: var(--background-light);
      border: 1px solid var(--border-color);
      opacity: 0; /* Başlangıçta gizli */
      transform: translateX(50px); /* Başlangıçta sağda */
      transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    }
    .question-display.active {
      opacity: 1;
      transform: translateX(0); /* Aktif olunca yerine gelsin */
    }
    .question-display.exit {
        opacity: 0;
        transform: translateX(-50px); /* Çıkarken sola gitsin */
    }

    .question-display p strong {
      font-size: 1.3em; color: var(--primary-dark); margin-bottom: 20px; display: block; line-height: 1.4;
    }
    .options label {
      display: block; margin-bottom: 12px; padding: 12px 15px; border-radius: 5px;
      border: 1px solid var(--border-color); background-color: var(--background-white);
      cursor: pointer; transition: background-color var(--transition-speed), border-color var(--transition-speed), color var(--transition-speed);
    }
    .options label:hover {
      background-color: var(--accent-color); color: var(--text-light); border-color: var(--accent-color);
    }
    .options input[type="radio"] { margin-right: 10px; transform: scale(1.2); cursor: pointer; }
    .options label.selected { /* JavaScript ile seçili cevaba eklenecek class */
        background-color: var(--primary-medium);
        color: var(--text-light);
        border-color: var(--primary-dark);
    }

    .quiz-controls { text-align: center; margin-top: 30px; }
    #progress-text { margin-bottom: 15px; font-weight: 500; color: var(--primary-medium); }

    .result { /* Sonuç alanı stilleri öncekiyle benzer */
      margin-top: 30px; padding: 25px; border: 1px solid var(--accent-color);
      border-radius: 8px; background-color: var(--background-white);
      line-height: 1.7; text-align: left; box-shadow: 0 2px 8px var(--shadow-color);
      transition: background-color var(--transition-speed), border-color var(--transition-speed);
    }
    .result strong { color: var(--primary-dark); font-size: 1.2em; }
    .result em { color: var(--primary-medium); font-style: normal; display: block; margin: 5px 0 15px 0; }

    /* Dark Mode Toggle (önceki test.html'den) */
    .toggle-container { position: absolute; top: 50%; transform: translateY(-50%); right: 20px; }
    .toggle-label { display: inline-block; cursor: pointer; user-select: none; }
    .toggle-input { display: none; }
    .toggle-slider {
      width: 50px; height: 24px; background-color: var(--primary-medium);
      border-radius: 12px; position: relative; transition: background-color var(--transition-speed);
    }
    .toggle-slider::before {
      content: ""; position: absolute; width: 20px; height: 20px; border-radius: 50%;
      background-color: var(--background-white); top: 2px; left: 2px; transition: transform var(--transition-speed);
    }
    .toggle-input:checked + .toggle-slider { background-color: var(--accent-color); }
    .toggle-input:checked + .toggle-slider::before { transform: translateX(26px); }

    /* ==== DARK MODE SPECIFIC STYLES ==== */
    body.dark-mode { background-color: var(--dm-background-body); color: var(--dm-text-primary); }
    body.dark-mode header { background-color: var(--dm-background-container); color: var(--dm-text-primary); }
    body.dark-mode nav { background-color: var(--primary-medium); }
    body.dark-mode nav a { color: var(--text-light); }
    body.dark-mode nav a:hover, body.dark-mode nav a.active { background-color: var(--dm-accent-color); }
    body.dark-mode .container { background-color: var(--dm-background-container); box-shadow: 0 4px 15px var(--dm-shadow-color); }
    body.dark-mode .question-display { background-color: var(--dm-background-body); border-color: var(--dm-border-color); }
    body.dark-mode .question-display p strong { color: var(--dm-text-primary); }
    body.dark-mode .options label { background-color: var(--dm-background-container); border-color: var(--dm-border-color); color: var(--dm-text-secondary); }
    body.dark-mode .options label:hover { background-color: var(--dm-accent-color); color: var(--text-light); border-color: var(--dm-accent-color); }
    body.dark-mode .options label.selected { background-color: var(--primary-medium); color: var(--text-light); border-color: var(--dm-accent-color); }
    body.dark-mode #progress-text { color: var(--dm-text-secondary); }
    body.dark-mode .result { background-color: var(--dm-background-container); border-color: var(--dm-accent-color); color: var(--dm-text-primary); }
    body.dark-mode .result strong { color: var(--dm-text-primary); }
    body.dark-mode .result em { color: var(--dm-text-secondary); }
    body.dark-mode footer { background-color: var(--dm-background-container); color: var(--dm-text-primary); }
    /* ==== SON: TEST SAYFASI YENİ STİLLERİ ==== */
  </style>
</head>
<body>
  <header>
    <h1>Finans Okuryazarlığı Testi</h1>
    <div class="toggle-container">
      <label class="toggle-label">
        <input type="checkbox" id="darkModeToggle" class="toggle-input">
        <span class="toggle-slider"></span>
      </label>
    </div>
  </header>
  <nav> <a href="index.html">Ana Sayfa</a> </nav>

  <div class="container">
    <div id="quiz-container">
      <div id="question-display-area">
        </div>
      <div id="progress-text"></div>
      <div class="quiz-controls">
        <button id="control-button" class="button-style">Teste Başla</button>
      </div>
    </div>
    <div class="result" id="result" style="display:none;">
        </div>
  </div>

  <footer> <p>© 2025 Alfinans</p> </footer>

<script>
    const quizData = [
      { question: "Faiz nedir?", options: {a: "Tasarruf yöntemidir.", b: "Paranın değer kaybetmesidir.", c: "Paranın kullanım bedelidir.", d: "Yatırımın getirisi ölçüsüdür."}, answer: "c" },
      { question: "Enflasyon nedir?", options: {a: "Fiyatların düşmesidir.", b: "Fiyatların artış göstermesidir.", c: "Paranın değer kazanmasıdır.", d: "Tasarruf oranlarının artmasıdır."}, answer: "b" },
      { question: "Bütçe nedir?", options: {a: "Ekonomik büyümedir.", b: "Yatırım stratejisidir.", c: "Borçlanma yöntemidir.", d: "Gelir ve giderlerin planlanmasıdır."}, answer: "d" },
      { question: "Yatırım nedir?", options: {a: "Tasarruf yapmaktır.", b: "Paranın harcanmasıdır.", c: "Paranın gelecekte değer kazanması amacıyla değerlendirilmesidir.", d: "Kredi kullanmaktır."}, answer: "c" },
      { question: "Diversifikasyon nedir?", options: {a: "Yatırımları çeşitlendirerek riskin azaltılmasıdır.", b: "Tüm yatırımı tek bir varlık üzerinde yoğunlaştırmaktır.", c: "Faiz oranlarının belirlenmesidir.", d: "Yatırım getirilerinin sabitlenmesidir."}, answer: "a" },
      { question: "Likidite nedir?", options: {a: "Yatırım getirisidir.", b: "Bir varlığın nakde çevrilebilme kolaylığıdır.", c: "Paranın tasarruf edilmesidir.", d: "Ekonomik büyümedir."}, answer: "b" },
      { question: "Kredi notu nedir?", options: {a: "Birey veya kurumun borç ödeme kapasitesini gösteren skordur.", b: "Faiz oranlarının ölçüsüdür.", c: "Yatırım getirilerinin oranıdır.", d: "Tasarrufun miktarını belirler."}, answer: "a" },
      { question: "Hisse senedi nedir?", options: {a: "Birikim aracıdır.", b: "Şirketin borçlanma senedidir.", c: "Ekonomik büyüme göstergesidir.", d: "Bir şirkete ait ortaklık payıdır."}, answer: "d" },
      { question: "Tahvil nedir?", options: {a: "Şirket ortaklığı belgesidir.", b: "Devlet veya şirketin borçlanma senedidir.", c: "Ekonomik kontrol göstergesidir.", d: "Yatırımın riskidir."}, answer: "b" },
      { question: "Döviz kuru nedir?", options: {a: "Yatırım getirilerini ölçer.", b: "Enflasyon oranını belirler.", c: "Bir ülkenin parasının başka bir ülkenin parasına karşı değeridir.", d: "Tasarruf oranını gösterir."}, answer: "c" },
      { question: "Borsa nedir?", options: {a: "Hisse senetlerinin alınıp satıldığı piyasa yeridir.", b: "Bir ülkenin para birimidir.", c: "Yatırım fonlarının yönetildiği platformdur.", d: "Ekonomik büyüme göstergesidir."}, answer: "a" },
      { question: "Faiz oranları nasıl belirlenir?", options: {a: "Yatırımcıların tercihlerine göre.", b: "Sadece devlet tarafından belirlenir.", c: "Uluslararası ticaret kurallarıyla.", d: "Merkez bankası politikaları ve piyasa dinamikleriyle."}, answer: "d" },
      { question: "Ekonomik durgunluk nedir?", options: {a: "Enflasyonun yüksek olduğu dönemdir.", b: "Ekonomik büyümenin yavaşlaması ve durması durumudur.", c: "Yatırımcıların piyasadan çekildiği süreçtir.", d: "Devlet müdahalesinin az olduğu dönemdir."}, answer: "b" },
      { question: "Mali kriz nedir?", options: {a: "Finansal sistemde ciddi çöküş ve likidite sorunlarının yaşandığı dönemdir.", b: "Ekonomik büyümenin hızlandığı dönemdir.", c: "Yatırımcıların kâr elde ettiği dönemdir.", d: "Enflasyonun sıfırlandığı dönemdir."}, answer: "a" },
      { question: "Vergi nedir?", options: {a: "Sadece zenginlere uygulanan kesintidir.", b: "Serbest piyasa koşullarında belirlenen bir ücrettir.", c: "Devletin kamu hizmetlerini finanse etmek için topladığı zorunlu ücrettir.", d: "Özel sektör tarafından belirlenen bir ücrettir."}, answer: "c" }
    ];

    let currentQuestionIndex = 0;
    let userAnswers = [];
    let score = 0;

    const questionDisplayAreaEl = document.getElementById('question-display-area');
    const controlButtonEl = document.getElementById('control-button');
    const resultEl = document.getElementById('result');
    const progressTextEl = document.getElementById('progress-text');
    const quizContainerEl = document.getElementById('quiz-container'); // localStorage mesajı için

    // Sayfa yüklendiğinde localStorage'dan önceki skoru kontrol et ve göster
    function displayPreviousScore() {
        const lastScore = localStorage.getItem('alfinansTestSonPuan');
        const lastDate = localStorage.getItem('alfinansTestSonTarih');

        if (lastScore !== null && lastDate !== null) {
            let previousScoreDiv = document.getElementById('previous-score-display');
            if (!previousScoreDiv) { // Eğer div yoksa oluştur
                previousScoreDiv = document.createElement('div');
                previousScoreDiv.id = 'previous-score-display';
                previousScoreDiv.style.padding = '10px';
                previousScoreDiv.style.marginBottom = '20px';
                previousScoreDiv.style.backgroundColor = 'var(--background-light)';
                previousScoreDiv.style.border = '1px solid var(--border-color)';
                previousScoreDiv.style.borderRadius = '5px';
                previousScoreDiv.style.textAlign = 'center';
                // Dark mode için de stil ekleyelim
                if (document.body.classList.contains('dark-mode')) {
                    previousScoreDiv.style.backgroundColor = 'var(--dm-background-body)';
                    previousScoreDiv.style.borderColor = 'var(--dm-border-color)';
                }
                // quizContainerEl'in başına ekle (kontrol butonundan önce)
                quizContainerEl.insertBefore(previousScoreDiv, questionDisplayAreaEl);
            }
            previousScoreDiv.innerHTML = `✏️ En son ${lastDate} tarihinde aldığınız puan: <strong>${lastScore} / ${quizData.length}</strong>`;
        }
    }
    
    // Dark mode toggle için de güncelleyelim ki localStorage mesajı da renk değiştirsin
    function updatePreviousScoreDisplayTheme() {
        const previousScoreDiv = document.getElementById('previous-score-display');
        if (previousScoreDiv) {
            if (document.body.classList.contains('dark-mode')) {
                previousScoreDiv.style.backgroundColor = 'var(--dm-background-body)';
                previousScoreDiv.style.borderColor = 'var(--dm-border-color)';
                // Metin rengi zaten body.dark-mode'dan geliyor olmalı.
            } else {
                previousScoreDiv.style.backgroundColor = 'var(--background-light)';
                previousScoreDiv.style.borderColor = 'var(--border-color)';
            }
        }
    }


    controlButtonEl.addEventListener('click', handleControlButtonClick);

    function handleControlButtonClick() {
        const buttonState = controlButtonEl.dataset.state || 'start';
        if (buttonState === 'start') {
            startQuiz();
        } else if (buttonState === 'next') {
            processAnswerAndLoadNext();
        } else if (buttonState === 'results') {
            processAnswerAndShowResults();
        }
    }

    function startQuiz() {
        currentQuestionIndex = 0;
        userAnswers = [];
        score = 0;
        resultEl.style.display = 'none';
        resultEl.innerHTML = '';
        
        // Varsa önceki skor mesajını kaldır veya gizle
        const previousScoreDiv = document.getElementById('previous-score-display');
        if (previousScoreDiv) {
            previousScoreDiv.style.display = 'none';
        }

        if(questionDisplayAreaEl) questionDisplayAreaEl.innerHTML = ''; // Önceki soruları temizle
        displayQuestion(currentQuestionIndex);
        controlButtonEl.textContent = 'Sonraki Soru';
        controlButtonEl.dataset.state = 'next';
        updateProgressText();
    }

    function displayQuestion(index) {
        // ... (önceki displayQuestion fonksiyonu içeriği aynı kalacak) ...
        const oldQuestionDiv = questionDisplayAreaEl.querySelector('.question-display');
        if (oldQuestionDiv) {
            oldQuestionDiv.classList.add('exit');
            oldQuestionDiv.addEventListener('transitionend', () => {
                if (oldQuestionDiv.classList.contains('exit')) { 
                    oldQuestionDiv.remove();
                }
            }, { once: true });
        }
        
        setTimeout(() => {
            const q = quizData[index];
            if (!q) return; 

            const questionDiv = document.createElement('div');
            questionDiv.classList.add('question-display');
            
            let optionsHTML = '<div class="options">';
            for (const key in q.options) {
                optionsHTML += `
                    <label>
                        <input type="radio" name="q${index}" value="${key}" required>
                        <span>${key.toUpperCase()}) ${q.options[key]}</span>
                    </label>`;
            }
            optionsHTML += '</div>';

            questionDiv.innerHTML = `<p><strong>${index + 1}. Soru:</strong> ${q.question}</p>${optionsHTML}`;
            if(questionDisplayAreaEl) questionDisplayAreaEl.appendChild(questionDiv);

            requestAnimationFrame(() => { 
                 requestAnimationFrame(() => { 
                    questionDiv.classList.add('active');
                 });
            });

            const labels = questionDiv.querySelectorAll('.options label');
            labels.forEach(label => {
                label.addEventListener('click', () => {
                    labels.forEach(l => l.classList.remove('selected')); 
                    label.classList.add('selected'); 
                });
            });
        }, oldQuestionDiv ? 400 : 0);
    }
    
    function updateProgressText() {
        if(progressTextEl) progressTextEl.textContent = `Soru ${currentQuestionIndex + 1} / ${quizData.length}`;
    }

    function processAnswerAndLoadNext() {
        const selectedOption = questionDisplayAreaEl.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
        if (!selectedOption) {
            alert('Lütfen bir cevap seçiniz!');
            return;
        }
        userAnswers[currentQuestionIndex] = selectedOption.value;

        currentQuestionIndex++;
        if (currentQuestionIndex < quizData.length) {
            displayQuestion(currentQuestionIndex);
            updateProgressText();
            if (currentQuestionIndex === quizData.length - 1) {
                controlButtonEl.textContent = 'Sonuçları Göster';
                controlButtonEl.dataset.state = 'results';
            }
        }
    }
    
    function processAnswerAndShowResults() {
        const selectedOption = questionDisplayAreaEl.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
         if (!selectedOption && currentQuestionIndex < quizData.length) { 
            alert('Lütfen son soruyu cevaplayınız!');
            return;
        }
        if (selectedOption) { 
             userAnswers[currentQuestionIndex] = selectedOption.value;
        }
        showResults();
    }

    function showResults() {
        const oldQuestionDiv = questionDisplayAreaEl.querySelector('.question-display');
        if (oldQuestionDiv) {
            oldQuestionDiv.classList.add('exit');
            oldQuestionDiv.addEventListener('transitionend', () => {
                if (oldQuestionDiv.classList.contains('exit')) {
                    oldQuestionDiv.remove();
                }
            }, { once: true });
        }
        if(progressTextEl) progressTextEl.textContent = "Test Tamamlandı!";

        score = 0;
        for (let i = 0; i < quizData.length; i++) {
            if (userAnswers[i] === quizData[i].answer) {
                score++;
            }
        }

        // Skoru ve tarihi localStorage'a kaydet
        try {
            localStorage.setItem('alfinansTestSonPuan', score.toString());
            const today = new Date();
            localStorage.setItem('alfinansTestSonTarih', today.toLocaleDateString('tr-TR')); // tr-TR formatı için
            console.log("ALFINANS DEBUG: Puan localStorage'a kaydedildi.");
        } catch (e) {
            console.error("ALFINANS HATA: localStorage'a yazılırken sorun oluştu:", e);
        }


        let commentary = "";
        if (score >= quizData.length * 0.8) { 
            commentary = "Tebrikler, mükemmel bir performans sergiledin!";
        } else if (score >= quizData.length * 0.6) { 
            commentary = "İyi bir sonuç, ancak bazı konularda daha dikkatli olmalısın.";
        } else {
            commentary = "Daha fazla çalışmalısın. Konuları tekrar gözden geçir!";
        }
        
        if(resultEl) {
            resultEl.innerHTML = `<strong>Toplam Puanınız: ${score} / ${quizData.length}</strong><br><em>${commentary}</em>`;
            resultEl.style.display = 'block';
        }
        
        // Yeniden başlat butonu ve önceki skor mesajını göster (test bitince)
        controlButtonEl.textContent = 'Testi Yeniden Başlat';
        controlButtonEl.dataset.state = 'start';
        displayPreviousScore(); // Sonuçlar gösterildikten sonra da önceki skoru (artık güncel olanı) göster.
        const previousScoreDiv = document.getElementById('previous-score-display');
        if (previousScoreDiv) {
             previousScoreDiv.style.display = 'block'; // Eğer gizlendiyse tekrar göster.
             updatePreviousScoreDisplayTheme(); // Tema güncellemesi
        }
    }

    // Dark Mode Toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    function applyDarkModePreference() { // Dark mode uygulama fonksiyonu
        if (localStorage.getItem('darkMode') === 'enabled') {
           darkModeToggle.checked = true;
           document.body.classList.add('dark-mode');
        } else {
           darkModeToggle.checked = false;
           document.body.classList.remove('dark-mode');
        }
        updatePreviousScoreDisplayTheme(); // Tema değiştiğinde mesajın da temasını güncelle
    }

    if (darkModeToggle) {
        darkModeToggle.addEventListener('change', function() {
          if(this.checked) {
            document.body.classList.add('dark-mode');
            localStorage.setItem('darkMode', 'enabled');
          } else {
            document.body.classList.remove('dark-mode');
            localStorage.setItem('darkMode', 'disabled');
          }
          updatePreviousScoreDisplayTheme(); // Tema değiştiğinde mesajın da temasını güncelle
        });
    }
    
    // DOMContentLoaded içinde çağırılacak ilk fonksiyonlar
    document.addEventListener('DOMContentLoaded', () => {
        console.log("ALFINANS DEBUG: test.html script fully loaded.");
        applyDarkModePreference(); // Kayıtlı dark mode tercihini uygula
        displayPreviousScore(); // Sayfa ilk yüklendiğinde önceki skoru göster
        
        // Kontrol butonunun ilk durumunu ayarla
        if(controlButtonEl) {
            controlButtonEl.textContent = 'Teste Başla';
            controlButtonEl.dataset.state = 'start';
        }
        if(progressTextEl) progressTextEl.textContent = ""; // Başlangıçta ilerleme metnini boşalt
        if(questionDisplayAreaEl) questionDisplayAreaEl.innerHTML = ""; // Başlangıçta soru alanını boşalt
        if(resultEl) resultEl.style.display = 'none'; // Başlangıçta sonuç alanını gizle
    });

  </script>
</body>
</html>